<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FIRE TRAIL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

    body {
      margin: 0;
      font-family: 'Orbitron', Arial, sans-serif;
      color: #eee;
      overflow-x: hidden;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
      position: relative;
      background: url('https://upload.wikimedia.org/wikipedia/commons/9/97/The_Earth_seen_from_Apollo_17.jpg') no-repeat center center fixed;
      background-size: cover;
      filter: drop-shadow(0 0 8px #ff4400);
    }

    #starsCanvas {
      pointer-events: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      display: block;
      background: transparent;
    }

    h1.main-heading {
      font-weight: 900;
      letter-spacing: 3px;
      color: #ff5a00;
      text-shadow: 0 0 10px #ff8000;
      margin-bottom: 1.5em;
      font-size: 3.3em;
      user-select: none;
      position: relative;
      z-index: 10;
    }

    .sim-box {
      background: rgba(0, 0, 0, 0.75);
      max-width: 480px;
      width: 100%;
      border-radius: 18px;
      box-shadow:
        0 0 15px #ff5500,
        inset 0 0 12px #ff3300;
      padding: 2em 2.5em 2em;
      color: #f8f0e3;
      backdrop-filter: blur(12px);
      border: 1.5px solid #ff6600;
      position: relative;
      z-index: 10;
    }

    h2 {
      color: #ff852a;
      margin-bottom: 1em;
      font-weight: 900;
      letter-spacing: 1.5px;
      text-shadow: 0 0 6px #ff9f44;
      user-select: none;
    }

    .input-row {
      margin-bottom: 1.4em;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1em;
    }

    label {
      flex: 1 1 140px;
      font-size: 1em;
      font-weight: bold;
      color: #ffbb55;
      text-shadow: 0 0 3px #cc6600;
      user-select: none;
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 220px;
      height: 8px;
      border-radius: 12px;
      background: linear-gradient(45deg, #ff4400, #ff9720);
      box-shadow: inset 0 0 8px #ff5511;
      cursor: pointer;
      transition: box-shadow 0.3s ease;
      flex: 1 1 auto;
    }

    input[type="range"]:focus {
      outline: none;
      box-shadow: 0 0 15px #ffbb33, inset 0 0 10px #ffcc22;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #ff6600;
      box-shadow: 0 0 12px #ffa533;
      cursor: pointer;
      border: 1px solid #cc5500;
      transition: background 0.3s ease;
      margin-top: -8px;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      background: #ff9933;
    }

    input[type="range"]::-moz-range-thumb {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #ff6600;
      box-shadow: 0 0 12px #ffa533;
      cursor: pointer;
      border: 1px solid #cc5500;
      transition: background 0.3s ease;
    }

    input[type="range"]::-moz-range-thumb:hover {
      background: #ff9933;
    }

    .value-display {
      width: 75px;
      text-align: right;
      font-weight: 700;
      color: #ffc977;
      user-select: none;
      font-family: 'Orbitron', monospace;
      letter-spacing: 1.1px;
      font-size: 1.1em;
      text-shadow: 0 0 5px #ffcc33;
      white-space: nowrap;
    }

    button {
      background: linear-gradient(45deg, #ff4400, #ff9922);
      color: #fff;
      border: none;
      padding: 1.1em 2em;
      border-radius: 16px;
      font-size: 1.25em;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 0 15px #ff7700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      transition: transform 0.25s ease-in-out, box-shadow 0.3s ease;
      user-select: none;
      margin-top: 1.4em;
      position: relative;
      z-index: 10;
    }

    button:hover {
      transform: scale(1.07);
      box-shadow: 0 0 25px #ff8800, 0 0 40px #ffc533;
    }

    #result {
      margin-top: 1.8em;
      padding: 1.3em 1.6em;
      background: rgba(255, 136, 0, 0.2);
      color: #000;
      font-weight: 700;
      border-radius: 14px;
      min-height: 3.4em;
      font-size: 1.15em;
      text-shadow: 0 0 4px #cc6600;
      box-shadow: inset 0 0 12px #ffbb33;
      user-select: none;
      position: relative;
      z-index: 10;
    }

    canvas#simCanvas {
      display: block;
      margin: 2em auto 0 auto;
      background: radial-gradient(circle at center, #001e3d 10%, #000 100%);
      border: 3px solid #ff8800;
      border-radius: 14px;
      box-shadow:
        0 0 18px #ffcc55,
        inset 0 0 14px #ff5500;
      position: relative;
      z-index: 10;
    }
  </style>
</head>
<body>
  <h1 class="main-heading">FIRE TRAIL</h1>

  <canvas id="starsCanvas"></canvas>

  <div class="sim-box" role="main" aria-label="FIRE TRAIL">
    <h2>FIRE TRAIL</h2>

    <div class="input-row" title="Meteor Size in meters">
      <label for="size">Meteor Size (m):</label>
      <input type="range" id="size" min="1" max="10000" value="100" step="1" aria-valuemin="1" aria-valuemax="10000" aria-valuenow="100" />
      <span id="sizeValue" class="value-display">100</span>
    </div>

    <div class="input-row" title="Speed in kilometers per second">
      <label for="speed">Speed (km/s):</label>
      <input type="range" id="speed" min="1" max="70" value="20" step="0.1" aria-valuemin="1" aria-valuemax="70" aria-valuenow="20" />
      <span id="speedValue" class="value-display">20.00</span>
    </div>

    <div class="input-row" title="Impact Angle in degrees">
      <label for="angle">Impact Angle (Â°):</label>
      <input type="range" id="angle" min="10" max="90" value="45" step="1" aria-valuemin="10" aria-valuemax="90" aria-valuenow="45" />
      <span id="angleValue" class="value-display">45</span>
    </div>

    <div class="input-row" title="Nearby Population in millions">
      <label for="population">Nearby Population (millions):</label>
      <input type="range" id="population" min="0.01" max="200" value="10" step="0.01" aria-valuemin="0.01" aria-valuemax="200" aria-valuenow="10" />
      <span id="populationValue" class="value-display">10.00</span>
    </div>

    <button onclick="startSimulation()" aria-label="Simulate Meteor Impact">Simulate Impact!</button>

    <canvas id="simCanvas" width="400" height="300" aria-live="polite" aria-label="Meteor impact animation"></canvas>
    <div id="result" role="region" aria-live="polite"></div>
  </div>

  <script>
    // Starfield Animation (unchanged from original)
    const starsCanvas = document.getElementById('starsCanvas');
    const starCtx = starsCanvas.getContext('2d');
    let stars = [];
    let width, height;

    class Star {
      constructor() {
        this.reset();
      }
      reset() {
        this.x = Math.random() * width;
        this.y = Math.random() * height;
        this.radius = Math.random() * 1.2 + 0.3;
        this.alpha = Math.random() * 0.8 + 0.2;
        this.dx = (Math.random() - 0.5) * 0.1;
        this.dy = (Math.random() - 0.5) * 0.1;
      }
      update() {
        this.x += this.dx;
        this.y += this.dy;
        if (this.x < 0) this.x = width;
        if (this.x > width) this.x = 0;
        if (this.y < 0) this.y = height;
        if (this.y > height) this.y = 0;
      }
      draw() {
        starCtx.beginPath();
        starCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        starCtx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
        starCtx.shadowColor = 'white';
        starCtx.shadowBlur = 4;
        starCtx.fill();
      }
    }

    function initStars() {
      width = window.innerWidth;
      height = window.innerHeight;
      starsCanvas.width = width;
      starsCanvas.height = height;
      stars = [];
      for (let i = 0; i < 150; i++) {
        stars.push(new Star());
      }
    }

    function animateStars() {
      starCtx.clearRect(0, 0, width, height);
      stars.forEach(star => {
        star.update();
        star.draw();
      });
      requestAnimationFrame(animateStars);
    }

    window.addEventListener('resize', () => {
      initStars();
    });

    initStars();
    animateStars();

    function updateValueDisplay(id, displayId, fixed = 0) {
      let input = document.getElementById(id);
      let display = document.getElementById(displayId);
      display.textContent = Number(input.value).toFixed(fixed);
      input.setAttribute("aria-valuenow", input.value);
    }

    ["size", "speed", "angle", "population"].forEach(id => {
      let fixed = (id === "speed" || id === "population") ? 2 : 0;
      updateValueDisplay(id, id + "Value", fixed);
      document.getElementById(id).addEventListener('input', () => {
        updateValueDisplay(id, id + "Value", fixed);
      });
    });

    const earthImg = new Image();
    earthImg.src = "https://upload.wikimedia.org/wikipedia/commons/9/97/The_Earth_seen_from_Apollo_17.jpg";

    let meteorColor = "#bb6633";

    let impactSound = new Audio('https://actions.google.com/sounds/v1/explosions/meteor_impact.ogg');
    let explosionSound = new Audio('https://actions.google.com/sounds/v1/explosions/fire_explosion.ogg');

    function playSound(sound) {
      sound.currentTime = 0;
      sound.play();
    }

    function drawExplosion(ctx, x, y, r, frame) {
      let grd = ctx.createRadialGradient(x, y, r / 8, x, y, r);
      grd.addColorStop(0, "rgba(255,255,255,1)");
      grd.addColorStop(0.3, "rgba(255,240,80,"+(0.9 - frame/30)+")");
      grd.addColorStop(0.6, "rgba(255,120,0,"+(0.5 - frame/60)+")");
      grd.addColorStop(1, "rgba(255,30,0,0)");
      ctx.save();
      ctx.beginPath();
      ctx.arc(x, y, r + 12*Math.sin(frame/2), 0, Math.PI*2);
      ctx.closePath();
      ctx.fillStyle = grd;
      ctx.shadowBlur = 20;
      ctx.shadowColor = "rgba(255,120,0,0.8)";
      ctx.fill();
      ctx.restore();
    }

    function drawDamage(ctx, x, y, r) {
      ctx.save();
      ctx.globalAlpha=0.52;
      ctx.beginPath();
      ctx.arc(x, y, r, 0, Math.PI*2);
      ctx.fillStyle = "rgba(150,30,0,0.55)";
      ctx.fill();
      ctx.globalAlpha=1;
      ctx.restore();
    }

    // Updated drawMeteor function with smooth irregular closed curve using Bezier curves
    function drawMeteor(ctx, x, y, size) {
      const r = size * 0.5;
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(x + r * 0.7, y);
      ctx.bezierCurveTo(
        x + r * 0.5, y - r * 1.1, 
        x - r * 0.6, y - r * 1.2, 
        x - r * 0.9, y - r * 0.3
      );
      ctx.bezierCurveTo(
        x - r * 1.0, y + r * 0.2, 
        x - r * 0.6, y + r * 0.9, 
        x, y + r * 0.8
      );
      ctx.bezierCurveTo(
        x + r * 0.4, y + r * 0.8, 
        x + r * 0.8, y + r * 0.5, 
        x + r * 0.7, y
      );
      ctx.closePath();
      ctx.fillStyle = meteorColor;
      ctx.shadowBlur = 14;
      ctx.shadowColor = "#ff9a33";
      ctx.fill();
      ctx.restore();
    }

    function clearCanvas(ctx) {
      ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
      ctx.save();
      ctx.fillStyle = "#050816";
      ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height);
      ctx.restore();
    }

    function drawEarthPhoto(ctx) {
      ctx.save();
      ctx.beginPath();
      ctx.arc(200,180,90,0,Math.PI*2);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(earthImg,20,40,360,360);
      ctx.restore();
      ctx.save();
      ctx.beginPath();
      ctx.arc(200,180,90,0,Math.PI*2);
      ctx.lineWidth = 4;
      ctx.strokeStyle = "#ffa644";
      ctx.shadowColor = "#ffb948";
      ctx.shadowBlur = 16;
      ctx.stroke();
      ctx.restore();
    }

    function simulateImpact() {
      const size = Number(document.getElementById("size").value);
      const speed = Number(document.getElementById("speed").value);
      const angle = Number(document.getElementById("angle").value);
      const population = Number(document.getElementById("population").value)*1e6;

      const density = 3000;
      const radius = size/2;
      const volume = (4/3)*Math.PI*Math.pow(radius,3);
      const mass = volume*density;
      const speed_mps = speed*1000;
      const energy = 0.5*mass*Math.pow(speed_mps,2);

      const effectiveEnergy = energy*Math.sin((angle*Math.PI)/180);
      const craterDiameter = Math.pow(effectiveEnergy,1/4.0)/22;

      let affectedArea = Math.PI*Math.pow(craterDiameter*2,2);
      let affectedPopulation = Math.min(population, population*(affectedArea/2e8));

      let effect;
      if(effectiveEnergy < 1e15) {
        effect = "A minor explosion; damage limited to local structures.";
      } else if(effectiveEnergy < 1e18) {
        effect = "Major local destruction; severe shockwave and fires.";
      } else if(effectiveEnergy < 1e20) {
        effect = "Regional devastation; widespread fires and infrastructure collapse.";
      } else {
        effect = "Global catastrophe; possible mass extinctions and climate effects.";
      }

      let popDisplay = affectedPopulation >= 1000000 ? (affectedPopulation/1e6).toFixed(2)+" million" : Math.round(affectedPopulation);

      document.getElementById("result").innerHTML = `
        <span style="font-weight:900; color:#000; font-size:1.08em;">
          IMPACT EFFECTS: ${effect}
        </span><br>
        <strong>Crater Diameter:</strong> ${craterDiameter.toFixed(1)} km<br>
        <strong>Estimated Population Affected:</strong> ${popDisplay}
      `;

      return { craterDiameter, effect };
    }

    function startSimulation() {
      playSound(impactSound);

      let canvas = document.getElementById("simCanvas");
      let ctx = canvas.getContext("2d");

      let size = Number(document.getElementById("size").value);
      let angle = Number(document.getElementById("angle").value);

      let impactRadius = 90;
      let centerX = 200, centerY = 180;
      let radians = (-angle+90)*(Math.PI/180);

      let startX = centerX - Math.cos(radians)*170;
      let startY = centerY - Math.sin(radians)*170;
      let hitX = centerX + Math.cos(radians)*impactRadius*0.94;
      let hitY = centerY + Math.sin(radians)*impactRadius*0.94;

      let ax = startX, ay = startY;
      let step = 0, totalSteps = 64;
      let explosionStep = 0, explosionSteps = 32;
      let { craterDiameter } = simulateImpact();
      let craterPx = Math.max((craterDiameter * 90) / 12000, 12);

      function animate() {
        clearCanvas(ctx);
        drawEarthPhoto(ctx);

        if (step < totalSteps) {
          ax += (hitX - startX) / totalSteps;
          ay += (hitY - startY) / totalSteps;
          drawMeteor(ctx, ax, ay, 11 + size / 30);
          step++;
          requestAnimationFrame(animate);
        } else if (explosionStep < explosionSteps) {
          if (explosionStep === 1) playSound(explosionSound);
          drawExplosion(ctx, hitX, hitY, 13 + (explosionStep * craterPx) / 18, explosionStep);
          drawDamage(ctx, hitX, hitY, craterPx + explosionStep);
          drawEarthPhoto(ctx);
          explosionStep++;
          requestAnimationFrame(animate);
        } else {
          drawEarthPhoto(ctx);
          drawDamage(ctx, hitX, hitY, craterPx*1.4);
        }
      }
      animate();
    }

    earthImg.onload = function() {
      let ctx = document.getElementById("simCanvas").getContext("2d");
      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
      ctx.save();
      ctx.fillStyle = "#050816";
      ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
      ctx.restore();
      drawEarthPhoto(ctx);
    };
  </script>
</body>
</html>